var maplemap={getPrice2Scale:function(f){var c=Math.ceil(f/10);var b=0;var a=0;var h=70;var g=50;var e=0;var d=(h-a)/(g-e);if(c>=g){b=0}else{b=h-d*c}return Math.floor(b)},setMarkerCss:function(c,a){var b="";color="hsl("+maplemap.getPrice2Scale(a)+", 100%, 50%)";if(c<10){b="<i class='common_bg icon_map_mark1' style='background-color:"+color+";'><span>"+c+"</span></i>"}if((c>=10)&&(c<100)){b="<i class='common_bg icon_map_mark2' style='background-color:"+color+";'><span>"+c+"</span></i>"}if((c>=100)&&(c<1000)){b="<i class='common_bg icon_map_mark3' style='background-color:"+color+";'><span>"+c+"</span></i>"}if(c>=1000){b="<i class='common_bg icon_map_mark4' style='background-color:"+color+";'><span>"+c+"</span></i>"}return b},initMap:function(c,d,b,e){markerArray=[];var f=new google.maps.LatLng(parseFloat(d),parseFloat(b));var a={center:f,zoom:e,zoomControl:true,mapTypeId:google.maps.MapTypeId.ROADMAP,minZoom:4,overviewMapControl:true,overviewMapControlOptions:{opened:true}};map=new google.maps.Map(document.getElementById(c),a);google.maps.event.addListener(map,"idle",function(){maplemap.changeMap(map,c)})},setMapView:function(c,a,b){map.setCenter(new google.maps.LatLng(parseFloat(c),parseFloat(a)));map.setZoom(parseInt(b))},setContent:function(a,g,h,e,c,d){var i=new google.maps.LatLng(parseFloat(g),parseFloat(h));var f=maplemap.setMarkerCss(e,d);var b=new RichMarker({position:i,map:a,draggable:false,content:f,flat:true});markerArray.push(b);google.maps.event.addListener(b,"click",function(j){if(e>1){$("#panelhtml").html(c);$("#houseviewpanel").panel("open")}else{$("#popuphtml").html(c);$("#houseviewpopup").popup("open")}})},addCenterMarker:function(f,e,c,h){var d="/static/map/images/";var g;if(h=="school"){g=d+"university.png"}else{if(h=="house"){g=d+"bighouse.png"}else{if(h=="city"){g=d+"city.png"}else{g=d+"city.png"}}}var a=new google.maps.LatLng(parseFloat(e),parseFloat(c));var b=new google.maps.Marker({map:f,position:a,icon:g})},setContentCount:function(a,f,g,i,b,d){var h=new google.maps.LatLng(parseFloat(f),parseFloat(g));var e=maplemap.setMarkerCss(i,d);var c=new RichMarker({position:h,map:a,draggable:false,content:e,flat:true});markerArray.push(c);google.maps.event.addListener(c,"click",function(){a.setCenter(this.position);var j=a.getZoom();a.setZoom(j+2)})},localSearch:function(a){var b=map.getCenter();request={location:b,radius:"3000",types:[local_type]};service=new google.maps.places.PlacesService(map);service.search(request,function(e,c){maplemap.clearAll();if(c==google.maps.places.PlacesServiceStatus.OK){for(var d=0;d<e.length;d++){maplemap.createMarker(e[d])}}})},createMarker:function(c){var b=c.geometry.location;var d;var e;if(local_type=="school"){e="<span class='ui-btn-icon-notext ui-icon-fa-graduation-cap'></span>"}else{if(local_type=="restaurant"){e="<span class='ui-btn-icon-notext ui-icon-fa-cutlery'></span>"}else{if(local_type=="bus_station"){e="<span class='ui-btn-icon-notext ui-icon-fa-cab'></span>"}else{if(local_type=="grocery_or_supermarket"){e="<span class='ui-btn-icon-notext ui-icon-fa-shopping-cart'></span>"}else{if(local_type=="hospital"){e="<span class='ui-btn-icon-notext ui-icon-fa-h-square'></span>"}else{if(local_type=="bank"){e="<span class='ui-btn-icon-notext ui-icon-fa-money'></span>"}else{e="<span class='ui-btn-icon-notext ui-icon-fa-cab'></span>"}}}}}}var a=new RichMarker({position:c.geometry.location,map:map,draggable:false,content:e,flat:true});markerArray.push(a);google.maps.event.addListener(a,"click",function(){$("#popuphtml").html("<div class='school_popup'><h3>名称：</h3><p>"+c.name+"</p></div>");$("#houseviewpopup").popup("open")})},clearAll:function(b){if(markerArray){for(var a in markerArray){markerArray[a].setMap(null)}markerArray.length=0}htmlArray=[];htmlArrayPosition=0},changeMap:function(b,l){console.log("Change Map");maplemap.clearAll(b);listAllHtml="";var g=60;var k=$("#"+l).height();var i=$("#"+l).width();var e=Math.ceil(i/g);var c=Math.ceil(k/g);var j=b.getBounds().getSouthWest();var m=b.getBounds().getNorthEast();var a=(m.lat()+j.lat())/2;var d=(m.lng()+j.lng())/2;var f=[];var h;_bounds=j.lat()+","+j.lng()+","+m.lat()+","+m.lng();$.ajax({url:"index.php?r=map/getMapHouse",type:"POST",dataType:"json",data:{bounds:_bounds,gridx:e,gridy:c,sr:options.sel_sr,housetype:options.sel_type,houseprice:options.sel_price,houseroom:options.sel_bedroom,housearea:options.sel_housearea},beforeSend:function(){},complete:function(){},success:function(r){if(!r.IsError){var q=r.Data.Total;$("#house_count").text(q);markerType=r.Data.Type;if((markerType=="city")||(markerType=="grid")){for(var o in r.Data.AreaHouseCount){var v=r.Data.AreaHouseCount[o];if(v.HouseCount>0){var s=v.TotalPrice/v.HouseCount;console.log("Name:"+v.NameCn+"Lat:"+v.GeocodeLat+"Count:"+v.HouseCount+"AvgPrice:"+s);maplemap.setContentCount(b,v.GeocodeLat,v.GeocodeLng,v.HouseCount.toString(),v.NameCn,s)}}}if(markerType=="house"){var t=1;var w="";var n=0;var u=r.Data.MapHouseList.length;$(r.Data.MapHouseList).each(function(C){if(C<(u-1)){var D=r.Data.MapHouseList[C+1].GeocodeLat;var E=r.Data.MapHouseList[C+1].GeocodeLng}var I="/"+this.CoverImg;var p="/"+this.CoverImgtn;var x=(this.SaleLease=="Lease")?Math.round(this.Price)*10000+"加元/月":Math.round(this.Price)+"万加元";var F=Math.round(this.Price);var y=parseFloat(this.GeocodeLat);var A=parseFloat(this.GeocodeLng);var G="<li class='panel_house_view' data-icon='false'><a data-ajax='false' href='index.php?r=mhouse/view&id="+this.MLS+"'><img src=' "+p+"'> <div class='panel_house_text'><div>"+this.Address+"</div><div >"+this.MunicipalityName+" "+this.ProvinceCname+"</div><div >"+this.HouseType+":"+this.Beds+"卧"+this.Baths+"卫"+this.Kitchen+"厨</div><div>价钱:"+x+"</div> </div></a></li>";listAllHtml=listAllHtml+G;if((E!=this.GeocodeLng)||(D!=this.GeocodeLat)){if(t==1){var z="<div class='map_info_content'><a href='index.php?r=mhouse/view&id="+this.MLS+"' data-ajax='false'> <img src='"+I+"'></a></div><div class='map_info_text'><div><a href='index.php?r=mhouse/view&id="+this.MLS+"' data-ajax='false'>MLS: "+this.MLS+"</a><div><div >价格："+x+"</div><div>地址："+this.Address+"</div><div>城市："+this.MunicipalityName+" "+this.ProvinceCname+" "+this.Zip+"</div><div >类型："+this.HouseType+" "+this.Beds+"卧"+this.Baths+"卫"+this.Kitchen+"厨</div></div>";maplemap.setContent(b,y,A,1,z,F)}else{+"<a data-ajax='false' href='index.php?r=mhouse/view&id="+this.MLS+"'><img src=' "+p+"'> <div class='panel_house_text'><div>"+this.Address+"</div><div >"+this.MunicipalityName+" "+this.ProvinceCname+"</div><div >"+this.HouseType+":"+this.Beds+"卧"+this.Baths+"卫"+this.Kitchen+"厨</div><div>价钱:"+x+"</div> </div></a></li>";var H=w+G;var B=(n+F)/t;maplemap.setContent(b,y,A,t,H,B);t=1;n=0;w=""}}else{++t;n=n+F;w=w+G}});if(q>30){}}}}})}};